# Personal CRM - Setup & Development Guide

## Prerequisites

- **Java 11** or higher
- **Node.js 18** or higher
- **MySQL 8.0** or higher
- **Maven 3.8** or higher
- **Docker & Docker Compose** (optional, for containerized deployment)

---

## Quick Start

### 1. Clone the Repository

```bash
git clone <repository-url>
cd CRM
```

### 2. Environment Setup

Copy the example environment file:

```bash
cp .env.example .env
```

Edit `.env` with your configuration:

```env
# Database
DB_USERNAME=root
DB_PASSWORD=your_mysql_password

# JWT Secret (generate a secure 256-bit key)
JWT_SECRET=your-256-bit-secret-key-here-make-it-long-and-random

# Google OAuth (optional)
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret

# Environment
SPRING_PROFILES_ACTIVE=dev
```

### 3. Database Setup

Create the MySQL database:

```sql
CREATE DATABASE personal_crm CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

The application will auto-create tables on first run (Hibernate DDL auto).

### 4. Start the Backend

```bash
cd backend
mvn spring-boot:run
```

Backend will start at `http://localhost:8080`

### 5. Start the Frontend (Development)

In a new terminal:

```bash
cd CRM  # project root
npm install
npm run dev
```

Frontend will start at `http://localhost:5173`

---

## Docker Deployment

### Using Docker Compose

```bash
# Build and start all services
docker-compose up -d

# View logs
docker-compose logs -f

# Stop services
docker-compose down
```

The application will be available at `http://localhost:8080`

### Docker Compose Services

| Service | Port | Description |
|---------|------|-------------|
| app | 8080 | Spring Boot + Frontend |
| db | 3306 | MySQL Database |

---

## Development Workflow

### Backend Development

```bash
cd backend

# Compile
mvn compile

# Run tests
mvn test

# Run application
mvn spring-boot:run

# Build JAR
mvn clean package
```

### Frontend Development

```bash
# Install dependencies
npm install

# Development server with hot reload
npm run dev

# Type checking
npx tsc --noEmit

# Linting
npm run lint

# Production build
npm run build

# Preview production build
npm run preview
```

### Full Build (Production)

```bash
# Frontend build
npm run build

# Backend build (includes frontend in JAR)
cd backend
mvn clean package -DskipTests

# Run the JAR
java -jar target/personal-crm-1.0.0.jar
```

---

## Project Configuration

### Backend Configuration

**`backend/src/main/resources/application.yml`**

```yaml
server:
  port: 8080

spring:
  datasource:
    url: jdbc:mysql://localhost:3306/personal_crm?useSSL=false&serverTimezone=UTC
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:password}
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: false
  security:
    oauth2:
      client:
        registration:
          google:
            client-id: ${GOOGLE_CLIENT_ID}
            client-secret: ${GOOGLE_CLIENT_SECRET}
            scope: email,profile

jwt:
  secret: ${JWT_SECRET}
  expiration: 86400000    # 24 hours
  refresh-expiration: 604800000  # 7 days
```

### Frontend Configuration

**`vite.config.ts`**

```typescript
export default defineConfig({
  server: {
    proxy: {
      '/api': 'http://localhost:8080'
    }
  },
  // PWA configuration
  plugins: [
    VitePWA({
      registerType: 'autoUpdate',
      // ...
    })
  ]
})
```

---

## Database Schema

The database schema is auto-generated by Hibernate. Key tables:

| Table | Description |
|-------|-------------|
| users | User accounts |
| contacts | Contact records |
| meetings | Meeting/interaction logs |
| reminders | Scheduled reminders |
| shares | Contact sharing records |
| message_templates | Message templates |

### Manual Schema Creation (if needed)

```sql
-- Users table
CREATE TABLE users (
    id VARCHAR(36) PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255),
    google_id VARCHAR(255),
    name VARCHAR(255),
    profile_picture VARCHAR(500),
    timezone VARCHAR(100),
    settings TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Contacts table
CREATE TABLE contacts (
    id VARCHAR(36) PRIMARY KEY,
    user_id VARCHAR(36) NOT NULL,
    name VARCHAR(255) NOT NULL,
    emails TEXT,
    phones TEXT,
    whatsapp_number VARCHAR(50),
    instagram_handle VARCHAR(100),
    company VARCHAR(255),
    tags TEXT,
    address TEXT,
    notes TEXT,
    birthday DATE,
    anniversary DATE,
    profile_picture VARCHAR(500),
    last_contacted_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- Add indexes for performance
CREATE INDEX idx_contacts_user_id ON contacts(user_id);
CREATE INDEX idx_contacts_last_contacted ON contacts(last_contacted_at);
```

---

## Testing

### Backend Tests

```bash
cd backend
mvn test
```

### Frontend Tests (to be added)

```bash
npm run test
```

---

## Troubleshooting

### Common Issues

**1. Database Connection Error**

```
Could not create connection to database server
```

Solution:
- Verify MySQL is running
- Check credentials in `.env`
- Ensure database exists

**2. JWT Secret Error**

```
JWT secret must be at least 256 bits
```

Solution: Use a longer JWT secret (at least 32 characters)

**3. CORS Error**

```
Access-Control-Allow-Origin header is missing
```

Solution: Check `SecurityConfig.java` CORS configuration

**4. Port Already in Use**

```
Port 8080 is already in use
```

Solution:
```bash
# Find process using port
lsof -i :8080

# Kill process
kill -9 <PID>
```

**5. Node Modules Issues**

```bash
rm -rf node_modules package-lock.json
npm install
```

---

## IDE Setup

### IntelliJ IDEA (Recommended for Backend)

1. Open the `backend` folder as a Maven project
2. Enable Lombok plugin
3. Set SDK to Java 11+
4. Run `CrmApplication.java`

### VS Code (Recommended for Frontend)

1. Open the project root folder
2. Install recommended extensions:
   - ESLint
   - Prettier
   - Tailwind CSS IntelliSense
   - TypeScript Vue Plugin (Volar)

---

## Environment Variables Reference

| Variable | Required | Default | Description |
|----------|----------|---------|-------------|
| DB_USERNAME | Yes | root | MySQL username |
| DB_PASSWORD | Yes | - | MySQL password |
| JWT_SECRET | Yes | - | JWT signing secret (256+ bits) |
| GOOGLE_CLIENT_ID | No | - | Google OAuth client ID |
| GOOGLE_CLIENT_SECRET | No | - | Google OAuth client secret |
| SPRING_PROFILES_ACTIVE | No | dev | Spring profile (dev/prod) |

---

## Production Deployment

### Environment Variables for Production

```env
SPRING_PROFILES_ACTIVE=prod
DB_USERNAME=prod_user
DB_PASSWORD=strong_production_password
JWT_SECRET=very-long-production-secret-key-256-bits-or-more
```

### Production Checklist

- [ ] Set strong database password
- [ ] Generate secure JWT secret
- [ ] Configure HTTPS/SSL
- [ ] Set up database backups
- [ ] Configure monitoring
- [ ] Set up logging
- [ ] Configure CORS for production domain
- [ ] Enable rate limiting
- [ ] Set up CDN for static assets

---

## Support

For issues and feature requests, please open a GitHub issue.
